<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>บันทึกรายงานการสอน | โรงเรียนสกลราชวิทยานุกูล</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-red: #C00000;
            --secondary-red: #D32F2F;
            --light-red: #FFEBEE;
            --white: #FFFFFF;
            --light-gray: #F8F9FA;
            --dark-gray: #495057;
        }
        
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--light-gray);
            color: var(--dark-gray);
        }
        
        .navbar-brand img {
            height: 40px;
        }
        
        .bg-school-red {
            background-color: var(--primary-red) !important;
        }
        
        .text-school-red {
            color: var(--primary-red) !important;
        }
        
        .btn-school-red {
            background-color: var(--primary-red);
            color: white;
            border: none;
        }
        
        .btn-school-red:hover {
            background-color: var(--secondary-red);
            color: white;
        }
        
        .main-content {
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .report-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .form-section {
            background-color: var(--light-red);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--dark-gray);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-red);
            box-shadow: 0 0 0 0.25rem rgba(192, 0, 0, 0.25);
        }
        
        .footer {
            background-color: var(--white);
            border-top: 1px solid #dee2e6;
            padding: 15px 0;
            margin-top: 30px;
        }
        
        .period-options .form-check {
            margin-bottom: 10px;
        }
        
        .period-options .form-check-input:checked {
            background-color: var(--primary-red);
            border-color: var(--primary-red);
        }
        
        .teacher-options .form-check {
            margin-bottom: 10px;
            padding-left: 2.5em;
        }
        
        .teacher-options .form-check-input:checked {
            background-color: var(--primary-red);
            border-color: var(--primary-red);
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #dee2e6;
            z-index: 1;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .step.active .step-circle {
            background-color: var(--primary-red);
            border-color: var(--primary-red);
            color: white;
        }
        
        .step.completed .step-circle {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }
        
        .step-label {
            font-size: 0.9rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="assets/logo.png" alt="Logo" class="me-2">
                <div>
                    <div class="fw-bold text-school-red" style="line-height: 1.2;">ระบบบันทึกการเรียนการสอน</div>
                    <small class="text-muted">โรงเรียนสกลราชวิทยานุกูล</small>
                </div>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="backLink">
                            <i class="bi bi-arrow-left text-school-red me-1"></i>กลับ
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-2 text-school-red"></i>
                            <span id="userName">ผู้ใช้งาน</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="profile.html"><i class="bi bi-person me-2"></i>โปรไฟล์</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right me-2"></i>ออกจากระบบ</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="container-fluid">
        <div class="main-content">
            <!-- Step Indicator -->
            <div class="step-indicator">
                <div class="step active" id="step1">
                    <div class="step-circle">1</div>
                    <div class="step-label">ข้อมูลพื้นฐาน</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-circle">2</div>
                    <div class="step-label">รายละเอียดการสอน</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-circle">3</div>
                    <div class="step-label">ตรวจสอบข้อมูล</div>
                </div>
            </div>
            
            <!-- Report Form -->
            <div class="report-card">
                <h2 class="fw-bold text-center text-school-red mb-4">บันทึกรายงานการสอน</h2>
                
                <form id="reportForm">
                    <!-- Step 1: Basic Information -->
                    <div class="form-section" id="step1Content">
                        <h4 class="fw-bold text-school-red mb-4">
                            <i class="bi bi-info-circle me-2"></i>ข้อมูลพื้นฐาน
                        </h4>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">วันที่เรียน</label>
                                <input type="date" class="form-control" id="reportDate" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ห้องเรียน</label>
                                <select class="form-select" id="classRoom" required>
                                    <option value="">เลือกห้องเรียน</option>
                                    <option value="ม.1/1">ม.1/1</option>
                                    <option value="ม.1/2">ม.1/2</option>
                                    <option value="ม.1/3">ม.1/3</option>
                                    <option value="ม.2/1">ม.2/1</option>
                                    <option value="ม.2/2">ม.2/2</option>
                                    <option value="ม.2/3">ม.2/3</option>
                                    <option value="ม.3/1">ม.3/1</option>
                                    <option value="ม.3/2">ม.3/2</option>
                                    <option value="ม.3/3">ม.3/3</option>
                                    <option value="ม.4/1">ม.4/1</option>
                                    <option value="ม.4/2">ม.4/2</option>
                                    <option value="ม.4/3">ม.4/3</option>
                                    <option value="ม.5/1">ม.5/1</option>
                                    <option value="ม.5/2">ม.5/2</option>
                                    <option value="ม.5/3">ม.5/3</option>
                                    <option value="ม.6/1">ม.6/1</option>
                                    <option value="ม.6/2">ม.6/2</option>
                                    <option value="ม.6/3">ม.6/3</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-12">
                                <label class="form-label">คาบเรียน</label>
                                <div class="period-options">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="period1" value="1">
                                                <label class="form-check-label" for="period1">
                                                    คาบ 1 (8:30-9:20)
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="period2" value="2">
                                                <label class="form-check-label" for="period2">
                                                    คาบ 2 (9:30-10:20)
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="period3" value="3">
                                                <label class="form-check-label" for="period3">
                                                    คาบ 3 (10:30-11:20)
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="period4" value="4">
                                                <label class="form-check-label" for="period4">
                                                    คาบ 4 (11:30-12:20)
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="period5" value="5">
                                                <label class="form-check-label" for="period5">
                                                    คาบ 5 (13:00-13:50)
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="period6" value="6">
                                                <label class="form-check-label" for="period6">
                                                    คาบ 6 (14:00-14:50)
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-school-red" id="nextStep1">
                                ถัดไป <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Teaching Details -->
                    <div class="form-section" id="step2Content" style="display: none;">
                        <h4 class="fw-bold text-school-red mb-4">
                            <i class="bi bi-journal-text me-2"></i>รายละเอียดการสอน
                        </h4>
                        
                        <div class="row mb-3">
                            <div class="col-12">
                                <label class="form-label">สถานะการสอน</label>
                                <div class="teacher-options">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="teachingStatus" id="hasTeacher" value="has_teacher" checked>
                                        <label class="form-check-label" for="hasTeacher">
                                            มีผู้สอน
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="teachingStatus" id="noTeacher" value="no_teacher">
                                        <label class="form-check-label" for="noTeacher">
                                            ไม่มีผู้สอน
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="teachingStatus" id="substituteTeacher" value="substitute_teacher">
                                        <label class="form-check-label" for="substituteTeacher">
                                            มีผู้สอนแทน
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="teachingStatus" id="otherActivity" value="other_activity">
                                        <label class="form-check-label" for="otherActivity">
                                            กิจกรรมอื่น
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-3" id="subjectField">
                            <div class="col-md-6">
                                <label class="form-label">วิชาเรียน</label>
                                <select class="form-select" id="subject">
                                    <option value="">เลือกวิชาเรียน</option>
                                    <option value="ค32102">ค32102 คณิตศาสตร์ 4</option>
                                    <option value="ค32202">ค32202 คณิตศาสตร์เพิ่มเติม 4</option>
                                    <option value="ค30292">ค30292 คณิตศาสตร์ พสวท.2</option>
                                    <option value="ค30298">ค30298 โครงงานคณิตศาสตร์ 1</option>
                                    <option value="ว32286">ว32286 สัมมนาวิทย์พลังสิบ</option>
                                    <option value="ว30290">ว30290 โครงงานวิทยาศาสตร์ 1</option>
                                    <option value="ว30284">ว30284 ความถนัดทางวิทย์ 2</option>
                                    <option value="ว32285">ว32285 เส้นทางนวัตกร</option>
                                    <option value="อ30202">อ30202 ภาษาอังกฤษเพื่อการสื่อสาร</option>
                                    <option value="ท30202">ท30202 ภาษาไทยเพื่ออาชีพ</option>
                                    <option value="ส30202">ส30202 สังคมศึกษาเพื่อการพัฒนา</option>
                                    <option value="พ30202">พ30202 สุขศึกษาและพลศึกษา</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ครูผู้สอน</label>
                                <select class="form-select" id="teacher">
                                    <option value="">เลือกครูผู้สอน</option>
                                    <option value="ครูวีระพล สุวรรณชัยรบ">คุณครูวีระพล สุวรรณชัยรบ</option>
                                    <option value="ครูรุจิพัชญ์ อรุวีวัฒนานนท์">คุณครูรุจิพัชญ์ อรุวีวัฒนานนท์</option>
                                    <option value="ครูผุสดี บุญหงษ์">คุณครูผุสดี บุญหงษ์</option>
                                    <option value="ครูดาราวรรณ ศรีทอง">คุณครูดาราวรรณ ศรีทอง</option>
                                    <option value="ครูสุพจน์ หิรัญเกิด">คุณครูสุพจน์ หิรัญเกิด</option>
                                    <option value="ครูนัทธมน จันทร์ทิพย์">คุณครูนัทธมน จันทร์ทิพย์</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3" id="activityField" style="display: none;">
                            <div class="col-12">
                                <label class="form-label">ระบุกิจกรรม</label>
                                <input type="text" class="form-control" id="activity" placeholder="เช่น กิจกรรมพัฒนาผู้เรียน, กิจกรรมหน้าเสาธง, ประชุมนักเรียน">
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-12">
                                <label class="form-label">หมายเหตุ (ถ้ามี)</label>
                                <textarea class="form-control" id="note" rows="3" placeholder="เช่น สอนตามแผน, ใช้สื่อการสอน PowerPoint, นักเรียนให้ความร่วมมือดี"></textarea>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-school-red" id="prevStep2">
                                <i class="bi bi-arrow-left me-2"></i> ย้อนกลับ
                            </button>
                            <button type="button" class="btn btn-school-red" id="nextStep2">
                                ถัดไป <i class="bi bi-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Review -->
                    <div class="form-section" id="step3Content" style="display: none;">
                        <h4 class="fw-bold text-school-red mb-4">
                            <i class="bi bi-check-circle me-2"></i>ตรวจสอบข้อมูล
                        </h4>
                        
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            กรุณาตรวจสอบข้อมูลก่อนบันทึก หากข้อมูลถูกต้องแล้วให้กดปุ่ม "บันทึกข้อมูล"
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-body">
                                <h5 class="card-title text-school-red">สรุปรายงานการสอน</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>วันที่:</strong> <span id="reviewDate"></span></p>
                                        <p><strong>ห้องเรียน:</strong> <span id="reviewClass"></span></p>
                                        <p><strong>คาบเรียน:</strong> <span id="reviewPeriods"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>สถานะการสอน:</strong> <span id="reviewStatus"></span></p>
                                        <p><strong>วิชาเรียน:</strong> <span id="reviewSubject"></span></p>
                                        <p><strong>ครูผู้สอน:</strong> <span id="reviewTeacher"></span></p>
                                    </div>
                                </div>
                                <div id="reviewActivity" style="display: none;">
                                    <p><strong>กิจกรรม:</strong> <span id="reviewActivityText"></span></p>
                                </div>
                                <div id="reviewNote" style="display: none;">
                                    <p><strong>หมายเหตุ:</strong> <span id="reviewNoteText"></span></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-school-red" id="prevStep3">
                                <i class="bi bi-arrow-left me-2"></i> ย้อนกลับ
                            </button>
                            <button type="button" class="btn btn-success" id="submitReport" data-bs-toggle="modal" data-bs-target="#confirmModal">
                                <i class="bi bi-check-circle me-2"></i> บันทึกข้อมูล
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Help Text -->
            <div class="alert alert-light">
                <h6 class="fw-bold text-school-red"><i class="bi bi-question-circle me-2"></i>คำแนะนำ</h6>
                <p class="mb-2">1. กรุณาบันทึกรายงานให้เสร็จสิ้นภายในวันนั้น ๆ</p>
                <p class="mb-2">2. สามารถบันทึกรายงานย้อนหลังได้ไม่เกิน 3 วัน</p>
                <p class="mb-2">3. หากมีปัญหาในการบันทึก กรุณาติดต่อครูประจำชั้นหรือผู้ดูแลระบบ</p>
                <p class="mb-0">4. ข้อมูลจะถูกบันทึกเข้าสู่ระบบกลางและไม่สามารถแก้ไขได้หลังจากบันทึกแล้ว</p>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 text-muted">พัฒนาโดยฝ่ายบริหารงานวิชาการ โรงเรียนสกลราชวิทยานุกูล</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0 text-muted">© 2024 สงวนลิขสิทธิ์</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-school-red">
                        <i class="bi bi-exclamation-triangle me-2"></i>ยืนยันการบันทึก
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>คุณต้องการบันทึกรายงานการสอนนี้หรือไม่?</p>
                    <div class="alert alert-warning">
                        <i class="bi bi-info-circle me-2"></i>
                        หลังจากบันทึกแล้วจะไม่สามารถแก้ไขข้อมูลได้
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                    <button type="button" class="btn btn-school-red" id="confirmSave">บันทึกข้อมูล</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-success">
                        <i class="bi bi-check-circle me-2"></i>บันทึกข้อมูลสำเร็จ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>บันทึกรายงานการสอนเรียบร้อยแล้ว</p>
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle me-2"></i>
                        ข้อมูลได้ถูกบันทึกเข้าสู่ระบบเรียบร้อยแล้ว
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-school-red" id="goToDashboard">กลับสู่แดชบอร์ด</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            document.getElementById('reportDate').value = todayStr;
            
            // Check session
            const session = localStorage.getItem('userSession');
            if (!session) {
                window.location.href = 'login.html';
            } else {
                const userData = JSON.parse(session);
                document.getElementById('userName').textContent = userData.name;
                
                // Set default class for students
                if (userData.role === 'student' && userData.class) {
                    document.getElementById('classRoom').value = userData.class;
                }
            }
            
            // Step navigation
            let currentStep = 1;
            
            // Teaching status change
            document.querySelectorAll('input[name="teachingStatus"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'other_activity') {
                        document.getElementById('subjectField').style.display = 'none';
                        document.getElementById('activityField').style.display = 'block';
                    } else {
                        document.getElementById('subjectField').style.display = 'block';
                        document.getElementById('activityField').style.display = 'none';
                    }
                });
            });
            
            // Step 1 to Step 2
            document.getElementById('nextStep1').addEventListener('click', function() {
                // Validate step 1
                const reportDate = document.getElementById('reportDate').value;
                const classRoom = document.getElementById('classRoom').value;
                const periods = document.querySelectorAll('input[type="checkbox"]:checked');
                
                if (!reportDate || !classRoom || periods.length === 0) {
                    alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                    return;
                }
                
                // Move to step 2
                document.getElementById('step1Content').style.display = 'none';
                document.getElementById('step2Content').style.display = 'block';
                document.getElementById('step3Content').style.display = 'none';
                
                // Update step indicator
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step2').classList.add('active');
                document.getElementById('step3').classList.remove('active');
                
                currentStep = 2;
            });
            
            // Step 2 back to Step 1
            document.getElementById('prevStep2').addEventListener('click', function() {
                document.getElementById('step1Content').style.display = 'block';
                document.getElementById('step2Content').style.display = 'none';
                document.getElementById('step3Content').style.display = 'none';
                
                document.getElementById('step1').classList.add('active');
                document.getElementById('step1').classList.remove('completed');
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step3').classList.remove('active');
                
                currentStep = 1;
            });
            
            // Step 2 to Step 3
            document.getElementById('nextStep2').addEventListener('click', function() {
                // Validate step 2
                const teachingStatus = document.querySelector('input[name="teachingStatus"]:checked').value;
                let isValid = true;
                
                if (teachingStatus !== 'other_activity') {
                    const subject = document.getElementById('subject').value;
                    const teacher = document.getElementById('teacher').value;
                    
                    if (!subject || !teacher) {
                        isValid = false;
                    }
                } else {
                    const activity = document.getElementById('activity').value;
                    if (!activity) {
                        isValid = false;
                    }
                }
                
                if (!isValid) {
                    alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                    return;
                }
                
                // Update review
                updateReview();
                
                // Move to step 3
                document.getElementById('step1Content').style.display = 'none';
                document.getElementById('step2Content').style.display = 'none';
                document.getElementById('step3Content').style.display = 'block';
                
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step2').classList.add('completed');
                document.getElementById('step3').classList.add('active');
                
                currentStep = 3;
            });
            
            // Step 3 back to Step 2
            document.getElementById('prevStep3').addEventListener('click', function() {
                document.getElementById('step1Content').style.display = 'none';
                document.getElementById('step2Content').style.display = 'block';
                document.getElementById('step3Content').style.display = 'none';
                
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step2').classList.add('active');
                document.getElementById('step2').classList.remove('completed');
                document.getElementById('step3').classList.remove('active');
                
                currentStep = 2;
            });
            
            // Update review function
            function updateReview() {
                // Date
                const date = new Date(document.getElementById('reportDate').value);
                const options = { day: 'numeric', month: 'numeric', year: 'numeric' };
                document.getElementById('reviewDate').textContent = date.toLocaleDateString('th-TH', options);
                
                // Class
                document.getElementById('reviewClass').textContent = document.getElementById('classRoom').value;
                
                // Periods
                const periods = [];
                document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                    periods.push(`คาบ ${cb.value}`);
                });
                document.getElementById('reviewPeriods').textContent = periods.join(', ');
                
                // Status
                const statusMap = {
                    'has_teacher': 'มีผู้สอน',
                    'no_teacher': 'ไม่มีผู้สอน',
                    'substitute_teacher': 'มีผู้สอนแทน',
                    'other_activity': 'กิจกรรมอื่น'
                };
                const status = document.querySelector('input[name="teachingStatus"]:checked').value;
                document.getElementById('reviewStatus').textContent = statusMap[status];
                
                // Subject and teacher
                if (status !== 'other_activity') {
                    document.getElementById('reviewSubject').textContent = document.getElementById('subject').selectedOptions[0].text;
                    document.getElementById('reviewTeacher').textContent = document.getElementById('teacher').value;
                    document.getElementById('reviewActivity').style.display = 'none';
                } else {
                    document.getElementById('reviewSubject').textContent = '-';
                    document.getElementById('reviewTeacher').textContent = '-';
                    document.getElementById('reviewActivityText').textContent = document.getElementById('activity').value;
                    document.getElementById('reviewActivity').style.display = 'block';
                }
                
                // Note
                const note = document.getElementById('note').value;
                if (note.trim()) {
                    document.getElementById('reviewNoteText').textContent = note;
                    document.getElementById('reviewNote').style.display = 'block';
                } else {
                    document.getElementById('reviewNote').style.display = 'none';
                }
            }
            
            // Confirm save
            document.getElementById('confirmSave').addEventListener('click', function() {
                // In a real app, this would send data to the server
                // For demo, we'll simulate a successful save
                
                // Close confirmation modal
                const confirmModal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
                confirmModal.hide();
                
                // Show success modal after a delay
                setTimeout(() => {
                    const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                    successModal.show();
                    
                    // Store report date for student dashboard
                    const session = localStorage.getItem('userSession');
                    if (session) {
                        const userData = JSON.parse(session);
                        if (userData.role === 'student') {
                            localStorage.setItem('lastReportDate', todayStr);
                        }
                    }
                }, 500);
            });
            
            // Go to dashboard after success
            document.getElementById('goToDashboard').addEventListener('click', function() {
                const session = localStorage.getItem('userSession');
                if (session) {
                    const userData = JSON.parse(session);
                    switch(userData.role) {
                        case 'admin':
                            window.location.href = 'dashboard_admin.html';
                            break;
                        case 'teacher':
                            window.location.href = 'dashboard_teacher.html';
                            break;
                        case 'student':
                            window.location.href = 'dashboard_student.html';
                            break;
                        default:
                            window.location.href = 'index.html';
                    }
                }
            });
            
            // Back link
            document.getElementById('backLink').addEventListener('click', function(e) {
                e.preventDefault();
                
                const session = localStorage.getItem('userSession');
                if (session) {
                    const userData = JSON.parse(session);
                    switch(userData.role) {
                        case 'admin':
                            window.location.href = 'dashboard_admin.html';
                            break;
                        case 'teacher':
                            window.location.href = 'dashboard_teacher.html';
                            break;
                        case 'student':
                            window.location.href = 'dashboard_student.html';
                            break;
                        default:
                            window.location.href = 'index.html';
                    }
                } else {
                    window.location.href = 'index.html';
                }
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('คุณต้องการออกจากระบบหรือไม่?')) {
                    localStorage.removeItem('userSession');
                    window.location.href = 'login.html';
                }
            });
        });
    </script>
</body>
</html>